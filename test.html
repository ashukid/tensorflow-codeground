<html height='100%' width='100%'>
    <head>
        <title>Tensorflow Codeground</title>
        <style>
            p{
                margin:0px;
                padding:0px;
            }
            pre {
                display: block;
                font-family: monospace;
                white-space: pre;
                margin: 1em 0;
            }
        </style>
        <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.6.3/svg.min.js"></script>
    </head>
    <body height='100%' width='100%'>
        <div style="position:absolute;font-size:30px;left:400px;color:blueviolet;font-family:Courier New, Courier, monospace"><u>Tensorflow Codeground</u></div>
        <div id="drawing"></div>
        <button style="position:relative;left:500px;top:20px;" onclick="generate_code()">Generate Code</button>
        <section style="border:1px solid red;display:none;;position:relative;top:100px;padding:40px" id='full_code'>

            <pre>
                import tensorflow as tf
                import numpy as np
            </pre>
            <pre>
                output_layer_node_count = <span id="class_count"></span>
                input_layer_node_count  = <span id="feature_count"></span>
                number_of_hidden_layers = <span id="hidden_count"></span>
            </pre>
            <pre id="node_count"></pre>
            <pre>
                def convert_into_one_hot(y_train,number_of_classes):
                    onehot_y=[]
                    for i in range(len(y_train)):
                        temp = np.zeros(number_of_classes)
                        temp[y_train[i]-1]=1
                        onehot_y.append(temp)
                
                    return onehot_y
            </pre>

            <pre>
                
            </pre>

            <pre>
                def train_neural_network(x,train_x,train_y):
                
                    prediction = neural_network_model(x)
                    cost = tf.reduce_mean( tf.nn.softmax_cross_entropy_with_logits(logits=prediction, labels=y) )
                    optimizer = tf.train.AdamOptimizer().minimize(cost)
                    
                    with tf.Session() as sess:
                
                        sess.run(tf.global_variables_initializer())
                        for epoch in range(hm_epochs):
                            epoch_loss = 0
                            i=0
                            while i < len(train_x):
                                start = i
                                end = i+batch_size
                                batch_x = np.array(train_x[start:end])
                                batch_y = np.array(train_y[start:end])
                
                                _, c = sess.run([optimizer, cost], feed_dict={x: batch_x,
                                                                                y: batch_y})
                                epoch_loss += c
                                i+=batch_size
                                
                            print('Epoch', epoch+1, 'completed out of',hm_epochs,'loss:',epoch_loss)
                
                        correct = tf.equal(tf.argmax(prediction, 1), tf.argmax(y, 1))
                
                        accuracy = tf.reduce_mean(tf.cast(correct, 'float'))
                        print('Accuracy:',accuracy.eval({x:mnist.test.images, y:mnist.test.labels}))
            </pre>
            <pre>
                def main():
                    # user set variables
                    batch_size = 100
                    learning_rate=0.01
                    hm_epochs = 10
                
                    """ training data """                x_train= ____                                                       
                    """ labels for training data """     y_train= ____                                      
                    """converting labels to one hot """  y_train= convert_into_one_hot(y_train,number_of_classes)
                
                    x = tf.placeholder('float', [None, number_of_features])
                    y = tf.placeholder('float', [None, number_of_classes])
                
                
                    train_neural_network(x,y,x_train,y_train,batch_size,learning_rate,hm_epochs)
            </pre>
            

                
        </section>


        <script>


            function generate_code(){
                document.getElementById("full_code").style.display="block";
                document.getElementById("class_count").innerHTML = output_node_count;
                document.getElementById("feature_count").innerHTML = input_node_count;
                document.getElementById("hidden_count").innerHTML = hidden_layers;

                for(i=0;i<hidden_layers;i++){
                    var node = document.createElement('span');
                    node.textContent = "                hidden_layer" + (i+1) + "_node_count = "+ hidden_node_count[i] ;
                    node.setAttribute("style","display:inherit;font-family:inherit;white-space:inherit;margin:0px;padding:0px");
                    var element = document.getElementById("node_count");
                    element.appendChild(node);
                }



            }



            var draw = SVG('drawing').size(1100,600)
            var group = draw.group();
            var group_button = draw.group();

            // automatic changable variables
            var input_node_count=2;
            var output_node_count=1;

            // manually changable variables
            var hidden_node_count=[3,2];
            var hidden_layers = hidden_node_count.length;
            var total_layers=hidden_layers+2;
            var height_offset=100;
            var width_offset=Math.floor(1000/total_layers);

            // Non changable variables
            var start_x=100;
            var start_y=100;
            var color = ['red','green','blue','pink','purple'];

            // button variables

        

            function draw_buttons(){
                var remove_buttons=[];
                var add_buttons=[];
                var hidden_button_add;
                var hidden_button_remove;
                var i,j;
                button_offset=0;
                for(i=0;i<total_layers;i++){
                    var temp=group_button.rect(20,20).fill('black').move(100+button_offset,70);
                    add_buttons.push(temp);
                    button_offset = button_offset + width_offset;
                } 
                button_offset=0;
                for(i=0;i<total_layers;i++){
                    var temp=group_button.rect(20,20).fill('brown').move(130+button_offset,70);
                    remove_buttons.push(temp);
                    button_offset = button_offset + width_offset;
                }

                hidden_button_add=group_button.rect(20,20).fill('black').move(520,580);        
                hidden_button_remove=group_button.rect(20,20).fill('brown').move(550,580); 


                // add buttons event listener
                add_buttons[0].click(function(){
                    if(input_node_count < 5)
                        input_node_count = input_node_count + 1;
                        main_nodes();
                    });

                for(i=0;i<hidden_layers;i++){
                    function click(i){
                        console.log(add_buttons.length);
                        add_buttons[i+1].click(function(){
                        if(hidden_node_count[i]<5){
                            hidden_node_count[i]+=1;
                        }
                        main_nodes();
                        });
                    }
                click(i);
                }

                add_buttons[total_layers-1].click(function(){
                    if(output_node_count < 5)
                        output_node_count = output_node_count+1;
                        main_nodes();
                });


                // remove buttons event listener
                remove_buttons[0].click(function(){
                    if(input_node_count > 1)
                        input_node_count = input_node_count - 1;
                        main_nodes();
                    });

                for(i=0;i<hidden_layers;i++){
                    function click(i){
                        remove_buttons[i+1].click(function(){
                        if(hidden_node_count[i] > 1){
                            hidden_node_count[i]-=1;
                        }
                        main_nodes();
                        });
                    }
                click(i);
                }

                remove_buttons[total_layers-1].click(function(){
                    if(output_node_count > 1)
                        output_node_count = output_node_count - 1;
                        main_nodes();
                });

                // hidden add button event listener
                hidden_button_add.click(function(){
                    if(hidden_layers < 8){
                        hidden_node_count.push(1);
                        hidden_layers = hidden_node_count.length;
                        total_layers=hidden_layers+2;
                        width_offset=Math.floor(1000/total_layers);
                    }
                    main_graph();
                });

                // hidden remove button event listener
                hidden_button_remove.click(function(){
                    if(hidden_layers > 1){
                        hidden_node_count.pop();
                        hidden_layers = hidden_node_count.length;
                        total_layers=hidden_layers+2;
                        width_offset=Math.floor(1000/total_layers);
                    }
                    main_graph();
                });  
            }
                

            // Main graph function
            function draw_graph(){
                var i,j,k,l;
                temp_width_offset=0;
                var input_offset=0;
                for(i=0;i<input_node_count;i++){
                    group.rect(50,50).fill(color[i]).move(start_x,start_y+input_offset);
                    input_offset+=height_offset;
                }

                var hidden_offset=0;
                for(i=0;i<hidden_layers;i++){
                    var total_nodes=hidden_node_count[i];
                    temp_width_offset+=width_offset;
                    hidden_offset=0;
                    for(j=0;j<total_nodes;j++){
                        group.circle(50).fill(color[j]).move(start_x+temp_width_offset,start_y+hidden_offset);
                        hidden_offset+=height_offset;
                    }
                }

                var output_offset=0;
                temp_width_offset+=width_offset;
                for(i=0;i<output_node_count;i++){
                    group.rect(50,50).fill(color[i]).move(start_x+temp_width_offset,start_y+output_offset);
                    output_offset+=height_offset;
                }

                var total_layer_nodes=[];
                hidden_node_count.splice(0,0,input_node_count);
                hidden_node_count.splice(hidden_layers+1,0,output_node_count);            
                var offset1=0,offset2=0,offset3=0;
                for(i=0;i<total_layers-1;i++){
                    layer1_count=hidden_node_count[i];
                    layer2_count=hidden_node_count[i+1];
                    offset1=0;
                    for(k=0;k<layer1_count;k++){
                        offset2=0;
                        for(l=0;l<layer2_count;l++){	
                                var line = group.line(150+offset3,125+offset1,100+width_offset+offset3,125+offset2)
                                line.stroke({ color: color[l], width: 2, linecap: 'round' })
                                offset2 = offset2+height_offset;
                            }
                        offset1 = offset1+height_offset;
                    }
                    offset3+=width_offset;
                }
                hidden_node_count.splice(0,1);
                hidden_node_count.splice(hidden_layers,hidden_layers+1);

            }   

            function main_nodes(){
                group.clear();
                draw_graph();
            }

            function main_graph(){
                group_button.clear();
                group.clear();
                draw_buttons();
                draw_graph();
            }

            main_graph();

                
        </script>
    </body>
</html>